- hosts:
    - localhost
  connection: local
  vars:
    arg_app_name: test_app
    arg_admin_name: test_admin
    arg_admin_location: "{{ arg_admin_name }}"
    arg_admin_host: localhost
    arg_admin_root: "/var/www/{{ arg_admin_name }}"
    arg_elasticsearch_host: localhost
    arg_kibana_host: localhost
    # Custom Vars
    nginx_root: "/var/www/{{ arg_app_name }}"
    nginx_location_confs:
      - elasticsearch
      - kibana
      - "{{ arg_admin_name }}"
      - "{{ arg_app_name }}"
    nginx_sendfile: "off"
  roles:
    #- setup/nginx/backend/golang/revel/develop
    - role: common/nginx/config/proxy
      nginx_config_proxy_root: "{{ nginx_root }}"
      nginx_config_proxy_config_name: "{{ arg_app_name }}"
      nginx_config_proxy_servers:
      - "{{ arg_app_name }}:9000"
    - role: common/nginx/config/rewrite_proxy
      nginx_config_rewrite_proxy_config_name: "{{ arg_admin_name }}"
      nginx_config_rewrite_proxy_host: "{{ arg_admin_host }}"
      nginx_config_rewrite_proxy_port: 9000
      nginx_config_rewrite_proxy_root: "{{ arg_admin_root }}"
    - role: common/nginx/backend/elasticsearch
      nginx_config_rewrite_proxy_host: "{{ arg_elasticsearch_host }}"
    - role: common/nginx/backend/kibana
      nginx_config_rewrite_proxy_host: "{{ arg_kibana_host }}"
    - common/supervisor/nginx
